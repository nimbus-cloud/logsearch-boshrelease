- type: remove
  path: /instance_groups/name=kibana

- type: remove
  path: /instance_groups/name=ls-router

- type: replace
  path: /instance_groups/name=maintenance/jobs/-
  value:
    name: cf-kibana
    release: logsearch-for-cloudfoundry
    consumes:
      elasticsearch: {from: elasticsearch_master}
      cloud_controller: {from: cloud_controller, deployment: cf}
      redis: {from: redis_link}
    properties:
      cloudfoundry:
        admin_password: "((cf_admin_password))"
      cf-kibana:
        cloudfoundry:
          api_security_group: "((api_security_group))"
          uaa_admin_client_secret: "((uaa_admin_client_secret))"
        oauth2_client_secret: "((kibana_oauth2_client_secret))"
      create-uaa-client:
        cloudfoundry:
          uaa_admin_client_secret: "((uaa_admin_client_secret))"
        oauth2_client_secret: "((kibana_oauth2_client_secret))"

- type: replace
  path: /instance_groups/-
  value:
    name: redis
    azs: [z1]
    instances: 1
    persistent_disk_type: default
    vm_type: default
    stemcell: default
    update:
      serial: true
    networks:
    - name: infra
    jobs:
    - name: redis
      release: logsearch-for-cloudfoundry
      provides:
        redis: {as: redis_link}


        # config_options:
        #   xpack.monitoring.enabled: false
        #   xpack.graph.enabled: false
        #   xpack.ml.enabled: false
        #   xpack.security.enabled: false
        #   xpack.watcher.enabled: false


# - type: replace
#   path: /instance_groups/-
#   value:
#     name: dedicated_shard_routing_errand
#     lifecycle: errand
#     azs: [z1]
#     instances: 1
#     persistent_disk_type: default
#     vm_type: default
#     stemcell: default
#     update:
#       serial: true
#     networks:
#     - name: infra
#     jobs:
#     - name: dedicated_shard_routing
#       release: logsearch-for-cloudfoundry
#       consumes:
#         elasticsearch: {from: elasticsearch_master}
#       properties:
#         dedicated_shard_routing:
#           dedicated_cf_orgs: ((dedicated-cf-orgs))
#           platform_logs: true


# - type: replace
#   path: /instance_groups/-
#   value:
#     name: upload-kibana-objects
#     lifecycle: errand
#     azs: [z1]
#     instances: 1
#     persistent_disk_type: default
#     vm_type: default
#     stemcell: default
#     update:
#       serial: true
#     networks:
#     - name: infra
#     jobs:
#     - consumes:
#         elasticsearch:
#           from: elasticsearch_master
#       name: upload-kibana-objects
#       release: logsearch-for-cloudfoundry