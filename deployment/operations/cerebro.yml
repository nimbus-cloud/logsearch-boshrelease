---
- type: replace
  path: /instance_groups/name=elasticsearch_master/jobs/-
  value:
    name: cerebro
    release: logsearch
    consumes:
      elasticsearch: {from: elasticsearch_master}
    properties:
      cerebro:
        secret: ((cerebro_secret_key))
        password: ((cerebro_auth_password))

- type: replace
  path: /instance_groups/name=elasticsearch_master/jobs/-
  value:
    name: route_registrar
    release: routing
    consumes:
      nats: {from: nats, deployment: cf}
    properties:
      route_registrar:
        routes:
        - name: cerebro-platform
          port: 9000
          registration_interval: 60s
          uris:
          - "cerebro-platform.((system_domain))"

- type: replace
  path: /instance_groups/name=elasticsearch_master/jobs/name=bpm?/release
  value: bpm

# --- define secrets for cerebro
- type: replace
  path: /variables/-
  value:
    name: cerebro_secret_key
    type: password

- type: replace
  path: /variables/-
  value:
    name: cerebro_auth_password
    type: password

- type: replace
  path: /releases/-
  value:
    name: routing
    version: latest
    

- type: replace
  path: /releases/-
  value:
    name: bpm
    version: latest

- type: replace
  path: /releases/-
  value:
    name: logsearch-for-cloudfoundry
    version: 210.4.0
    url: https://bosh.io/d/github.com/cloudfoundry-community/logsearch-for-cloudfoundry?v=210.4.0
    sha1: 423f801b174aa7db9c2f16c6ad836dd4566ace7d
