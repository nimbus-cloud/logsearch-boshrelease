---
name: syslog_forwarder

packages:
  - haproxy

templates:
  haproxy.config.erb: config/haproxy.config
  haproxy_ctl: bin/haproxy_ctl
  monit_debugger: bin/monit_debugger
  cert.pem.erb: config/cert.pem
  helpers/ctl_setup.sh: helpers/ctl_setup.sh
  helpers/ctl_utils.sh: helpers/ctl_utils.sh
  properties.sh.erb: data/properties.sh

consumes:
- name: ingestor
  type: ingestor
  optional: true
- name: syslog_forwarder
  type: syslog_forwarder
  optional: true

properties:
  haproxy.syslog_server:
    description: "An IPv4 address optionally followed by a colon and a UDP port. It can also be an IPv6 address or filesystem path to a UNIX domain socket."
    default: "127.0.0.1"
  haproxy.log_level:
    description: "Log level"
    default: "info"
  haproxy.ssl_pem:
    description: "SSL certificate (PEM file).  Omit if you don't want to use SSL"
    default: ~

  haproxy.connect_timeout:
    description: "Timeout waiting for connections to establish to a server (in seconds)"
    default:     5
  haproxy.client_timeout:
    description: "Timeout waiting for data from a client (in seconds)"
    default:     30
  haproxy.server_timeout:
    description: "Timeout waiting for data from a server (in seconds)"
    default:     30
  haproxy.queue_timeout:
    description: "Timeout for requests queued waiting for free connection slots (in seconds)"
    default:     30

  haproxy.ingestor.syslog.inbound_port:
    description: "The public port of the ingestor service"
    default: 5514
  haproxy.ingestor.syslog.backend_port:
    description: "The port number the ingestor backends are listening on"
    default: 5514
  haproxy.ingestor.relp.inbound_port:
    description: "The public port of the ingestor service"
    default: 2514
  haproxy.ingestor.relp.backend_port:
    description: "The port number the ingestor backends are listening on"
    default: 2514
  haproxy.ingestor.tls.inbound_port:
    description: "The public port of the ingestor service"
    default: 6514
  haproxy.ingestor.tls.backend_port:
    description: "The port number the ingestor backends are listening on"
    default: 6514
  haproxy.ingestor.backend_servers:
    description: "Array of the ingestor backend IPs"
    default: []
  haproxy.ingestor.backend_port:
    description: "The port number the ingestor backends are listening on"
    default: 5514
  haproxy.ingestor.enable_ssl:
    description: "Enable or Disable SSL for for syslog/ingestor traffic on haproxy"
    default: true


  haproxy.enable_stats_socket:
    description: "Whether to enable a socket that can be used to query errors and status"
    default: false
